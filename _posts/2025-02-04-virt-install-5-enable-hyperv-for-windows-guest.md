---
layout: post
title: "virt-install-5 enable hyperv features for Windows Guest by default"
---

# What happen: virt-install creating Windows VM fail after update system fedora-41
```
Starting install... 
ERROR unsupported configuration: host doesn't support hyperv 'vpindex' feature
ERROR unsupported configuration: host doesn't support hyperv 'vpindex' feature
```

# why
virt-install version update from 4.x to 5.0. and in new virt-install-5.0, it enables the hyperv features
when creating Windows VM. but I used the option --qemu-commandline="-cpu host,+svm" it overwrite the
-cpu option that generated by virt-install+virsh ...

# workaround or resolution
There is also a --cpu option for virt-install, using **--cpu=host,+svm** instead **--qemu-commandline="-cpu host,+svm"** fixed the issue.  
So generally don't use the **--qemu-commandline=** option unless you know what you are doing.

# about hyperv features
[EN] KVM on x86 implements Hyper-V Enlightenments for Windows guests. These features make Windows and Hyper-V guests think they’re running on top of a Hyper-V compatible hypervisor and use Hyper-V specific features.  

[ZH] KVM 在 x86上为 Windows Guest 实现了 HyperV Enlightenment，这些特性会让 Windows 和其他 HyperV 的 Guest 认为他们运行在 HyperV 兼容的 Hypervisor 上，这样Guest就会自动开启一些半虚拟化的性能优化。  

see also:  
- [Hyper-V Enlightenments](https://www.qemu.org/docs/master/system/i386/hyperv.html)
- [KVM中的HperV增强](https://blog.kernel.love/hyperv-enlightenment.html)
- [优化 Windows 虚拟机](https://docs.redhat.com/zh-cn/documentation/red_hat_enterprise_linux/9/html/configuring_and_managing_virtualization/optimizing-windows-virtual-machines-on-rhel_installing-and-managing-windows-virtual-machines-on-rhel)

